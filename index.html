<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>–ò–≥—Ä–æ–≤–æ–π –∞–≤—Ç–æ–º–∞—Ç</title>
<style>
  /* –ü—Ä–æ—Å—Ç–∞—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è */
  #reels { font-size: 50px; margin: 20px 0; }
  #result { font-weight: bold; margin: 10px 0; }
</style>
</head>
<body>

<h1>–ò–≥—Ä–æ–≤–æ–π –∞–≤—Ç–æ–º–∞—Ç</h1>
<div>–ë–∞–ª–∞–Ω—Å: <span id="balance">0</span> ‚ÇΩ</div>
<div>–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É (–º–∏–Ω–∏–º—É–º 10 ‚ÇΩ):</div>
<input type="number" id="stakeInput" value="10" min="10" />
<button id="spinBtn">–ö—Ä—É—Ç–∏—Ç—å</button>
<div id="reels">
  <span id="reel1">üé∞</span>
  <span id="reel2">üé∞</span>
  <span id="reel3">üé∞</span>
</div>
<div id="result"></div>

<script>
const symbols = ['üçí', 'üçã', 'üîî', '‚≠ê', 'üçÄ'];
const balanceSpan = document.getElementById('balance');
const reel1Span = document.getElementById('reel1');
const reel2Span = document.getElementById('reel2');
const reel3Span = document.getElementById('reel3');
const resultDiv = document.getElementById('result');
const spinBtn = document.getElementById('spinBtn');

const urlParams = new URLSearchParams(window.location.search);
const userId = urlParams.get('id') ? Number(urlParams.get('id')) : null;

// –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≤–∞—à GitHub —Ç–æ–∫–µ–Ω
const githubToken = '–í–ê–®_–¢–û–ö–ï–ù';

async function fetchUsers() {
  const response = await fetch('https://raw.githubusercontent.com/SaweNap/dfjghdfifgJSON/main/users.json');
  const users = await response.json();
  return users;
}

async function saveUsers(users) {
  const apiUrl = `https://api.github.com/repos/SaweNap/dfjghdfifgJSON/contents/users.json`;
  const response = await fetch(apiUrl, {
    headers: {
      'Authorization': `token ${githubToken}`,
      'Accept': 'application/vnd.github.v3+json'
    }
  });
  const data = await response.json();
  const sha = data.sha;
  const contentBase64 = btoa(JSON.stringify(users));
  await fetch(apiUrl, {
    method: 'PUT',
    headers: {
      'Authorization': `token ${githubToken}`,
      'Accept': 'application/vnd.github.v3+json'
    },
    body: JSON.stringify({
      message: '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
      content: contentBase64,
      sha: sha
    })
  });
}

async function getUserBalance(userId) {
  try {
    const users = await fetchUsers();
    const user = users.find(u => u.id === userId);
    return user ? user.balance : 0;
  } catch (e) {
    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞:', e);
    return 0;
  }
}

async function updateUserBalance(userId, newBalance) {
  const users = await fetchUsers();
  const userIndex = users.findIndex(u => u.id === userId);
  if (userIndex !== -1) {
    users[userIndex].balance = newBalance;
    await saveUsers(users);
  }
}

async function updateBalanceDisplay() {
  if (!userId) {
    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω');
    return;
  }
  const balance = await getUserBalance(userId);
  balanceSpan.textContent = balance.toFixed(2);
  window.currentBalance = balance; // —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∏–≥—Ä–æ–≤–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ
}

async function processGame() {
  if (!userId) {
    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω');
    return;
  }
  let balance = await getUserBalance(userId);
  const stake = parseInt(document.getElementById('stakeInput').value);
  if (isNaN(stake) || stake < 10) {
    alert('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ 10 ‚ÇΩ');
    return;
  }
  if (stake > balance) {
    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
    return;
  }
  // –°–Ω–∏–º–∞–µ–º —Å—Ç–∞–≤–∫—É
  balance -= stake;
  await updateUserBalance(userId, balance);
  await updateBalanceDisplay();

  // –ö—Ä—É—Ç—è—Ç—Å—è –±–∞—Ä–∞–±–∞–Ω—ã
  const reel1 = symbols[Math.floor(Math.random() * symbols.length)];
  const reel2 = symbols[Math.floor(Math.random() * symbols.length)];
  const reel3 = symbols[Math.floor(Math.random() * symbols.length)];
  reel1Span.textContent = reel1;
  reel2Span.textContent = reel2;
  reel3Span.textContent = reel3;

  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à
  let payoutMultiplier = 0;
  if (Math.random() < 0.02) {
    payoutMultiplier = 10; // –¥–∂–µ–∫–ø–æ—Ç
    resultDiv.textContent = `üéâ –î–∂–µ–∫–ø–æ—Ç! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${stake * payoutMultiplier} ‚ÇΩ!`;
  } else if (Math.random() < 0.1) {
    payoutMultiplier = 3; // –±–æ–Ω—É—Å
    resultDiv.textContent = `üéÅ –ë–æ–Ω—É—Å! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${stake * payoutMultiplier} ‚ÇΩ!`;
  } else if (reel1 === reel2 && reel2 === reel3) {
    payoutMultiplier = 5; // —Ç—Ä–∏ –≤ —Ä—è–¥
    resultDiv.textContent = `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${stake * payoutMultiplier} ‚ÇΩ!`;
  } else if (reel1 === reel2 || reel2 === reel3 || reel1 === reel3) {
    payoutMultiplier = 2; // –¥–≤–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ
    resultDiv.textContent = `–ù–µ–ø–ª–æ—Ö–æ! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${stake * payoutMultiplier} ‚ÇΩ!`;
  } else {
    resultDiv.textContent = '–ü–æ–≤–µ–∑–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑!';
  }

  // –ï—Å–ª–∏ –µ—Å—Ç—å –≤—ã–∏–≥—Ä—ã—à ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
  if (payoutMultiplier > 0) {
    balance += stake * payoutMultiplier;
    await updateUserBalance(userId, balance);
    await updateBalanceDisplay();
  }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏
document.getElementById('spinBtn').onclick = processGame;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
updateBalanceDisplay();
</script>

</body>
</html>
