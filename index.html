<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å–ª–æ—Ç-–º–∞—à–∏–Ω–∞</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; background:#222; color:#fff; margin:0; padding:20px; }
  #reels { display: flex; justify-content: center; margin:20px; }
  .reel { width:80px; height:80px; border:2px solid #fff; font-size:50px; display:flex; align-items:center; justify-content:center; margin:0 10px; }
  #balance { font-size:20px; margin:10px; }
  #stake { font-size:20px; }
  #result { margin-top:20px; font-size:18px; }
  button { padding:10px 20px; font-size:16px; margin-top:10px; }
</style>
</head>
<body>

<h1>–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å–ª–æ—Ç-–º–∞—à–∏–Ω–∞</h1>
<div id="balance">–ë–∞–ª–∞–Ω—Å: <span id="balanceValue">Loading...</span> ‚ÇΩ</div>
<div>
  <label for="stakeInput">–°—Ç–∞–≤–∫–∞:</label>
  <input type="number" id="stakeInput" min="10" max="500" value="10" />
</div>
<div id="reels">
  <div class="reel" id="reel1">üçí</div>
  <div class="reel" id="reel2">üçí</div>
  <div class="reel" id="reel3">üçí</div>
</div>
<button id="spinBtn">–ò–≥—Ä–∞—Ç—å</button>
<div id="result"></div>

<script>
const symbols = ['üçí', 'üçã', 'üîî', '‚≠ê', 'üçÄ', '7Ô∏è‚É£'];
let balance = 0; // –ó–∞–≥—Ä—É–∂–∞—Ç—å –∏–∑ API
let userId = null;

const balanceSpan = document.getElementById('balanceValue');
const resultDiv = document.getElementById('result');
const spinBtn = document.getElementById('spinBtn');

const urlParams = new URLSearchParams(window.location.search);
userId = urlParams.get('id'); // –ü–æ–ª—É—á–∞–µ–º id –∏–∑ URL

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –∏–∑ —Ñ–∞–π–ª–∞
async function getUserBalance(userId) {
  try {
    const response = await fetch(`https://raw.githubusercontent.com/SaweNap/dfjghdfifgJSON/main/users.json`);
    const users = await response.json();
    const user = users.find(u => u.id.toString() === userId);
    return user ? user.balance : 0;
  } catch (e) {
    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞:', e);
    return 0;
  }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
function updateBalanceDisplay() {
  document.getElementById('balanceValue').textContent = balance;
}

// –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
async function init() {
  if (userId) {
    balance = await getUserBalance(userId);
    updateBalanceDisplay();
  } else {
    document.getElementById('balanceValue').textContent = 'N/A';
  }
}
init();

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ GitHub
async function updateBalanceOnServer(newBalance) {
  const githubToken = 'ghp_abcdef1234567890abcdef1234567890abcdef';
  const repo = 'SaweNap/dfjghdfifgJSON';
  const path = 'users.json';

  const apiUrl = `https://api.github.com/repos/${repo}/contents/${path}`;

  // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π sha —Ñ–∞–π–ª–∞
  const response = await fetch(apiUrl, {
    headers: {
      'Authorization': `token ${githubToken}`,
      'Accept': 'application/vnd.github.v3+json'
    }
  });
  const data = await response.json();
  const sha = data.sha;

  // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞
  const updatedContent = JSON.stringify(
    (await fetch(apiUrl, {
      headers: {
        'Authorization': `token ${githubToken}`,
        'Accept': 'application/vnd.github.v3+json'
      }
    }).then(res => res.json())).content ? atob((await fetch(apiUrl, {headers: { 'Authorization': `token ${githubToken}` }}).then(res => res.json())).content) : ''
  );

  // –í–∞—Ä–∏–∞–Ω—Ç: –æ–±–Ω–æ–≤–ª—è–µ–º —Ñ–∞–π–ª
  const responseUpdate = await fetch(apiUrl, {
    method: 'PUT',
    headers: {
      'Authorization': `token ${githubToken}`,
      'Accept': 'application/vnd.github.v3+json'
    },
    body: JSON.stringify({
      message: '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
      content: btoa(JSON.stringify(users)),
      sha: sha
    })
  });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
async function saveUsers(users) {
  const githubToken = 'ghp_–í–ê–®_–¢–û–ö–ï–ù'; // –≤—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π —Ç–æ–∫–µ–Ω
  const repo = 'SaweNap/dfjghdfifgJSON';
  const path = 'users.json';
  const apiUrl = `https://api.github.com/repos/${repo}/contents/${path}`;

  const response = await fetch(apiUrl, {
    headers: {
      'Authorization': `token ${githubToken}`,
      'Accept': 'application/vnd.github.v3+json'
    }
  });
  const data = await response.json();
  const sha = data.sha;

  await fetch(apiUrl, {
    method: 'PUT',
    headers: {
      'Authorization': `token ${githubToken}`,
      'Accept': 'application/vnd.github.v3+json'
    },
    body: JSON.stringify({
      message: '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
      content: btoa(JSON.stringify(users)),
      sha: sha
    })
  });
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ò–≥—Ä–∞—Ç—å"
document.getElementById('spinBtn').onclick = async () => {
  if (!userId) {
    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω');
    return;
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
  balance = await getUserBalance(userId);
  updateBalanceDisplay();

  const stake = parseInt(document.getElementById('stakeInput').value);
  if (isNaN(stake) || stake < 10) {
    alert('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ 10 ‚ÇΩ');
    return;
  }
  if (stake > balance) {
    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
    return;
  }

  // –°–Ω–∏–º–∞–µ–º —Å—Ç–∞–≤–∫—É
  balance -= stake;
  updateBalanceDisplay();

  // –ö—Ä—É—Ç—è—Ç—Å—è –±–∞—Ä–∞–±–∞–Ω—ã
  const reel1 = symbols[Math.floor(Math.random() * symbols.length)];
  const reel2 = symbols[Math.floor(Math.random() * symbols.length)];
  const reel3 = symbols[Math.floor(Math.random() * symbols.length)];
  document.getElementById('reel1').textContent = reel1;
  document.getElementById('reel2').textContent = reel2;
  document.getElementById('reel3').textContent = reel3;

  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à
  let payoutMultiplier = 0;
  if (Math.random() < 0.02) { // –¥–∂–µ–∫–ø–æ—Ç
    payoutMultiplier = 10;
    resultDiv.textContent = `üéâ –î–∂–µ–∫–ø–æ—Ç! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${stake * payoutMultiplier} ‚ÇΩ!`;
  } else if (Math.random() < 0.1) { // –±–æ–Ω—É—Å
    payoutMultiplier = 3;
    resultDiv.textContent = `üéÅ –ë–æ–Ω—É—Å! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${stake * payoutMultiplier} ‚ÇΩ!`;
  } else if (reel1 === reel2 && reel2 === reel3) {
    payoutMultiplier = 5;
    resultDiv.textContent = `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${stake * payoutMultiplier} ‚ÇΩ!`;
  } else if (reel1 === reel2 || reel2 === reel3 || reel1 === reel3) {
    payoutMultiplier = 2;
    resultDiv.textContent = `–ù–µ–ø–ª–æ—Ö–æ! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${stake * payoutMultiplier} ‚ÇΩ!`;
  } else {
    resultDiv.textContent = '–ü–æ–≤–µ–∑–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑!';
  }

  // –ï—Å–ª–∏ –µ—Å—Ç—å –≤—ã–∏–≥—Ä—ã—à, –¥–æ–±–∞–≤–ª—è–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
  if (payoutMultiplier > 0) {
    balance += stake * payoutMultiplier;
    updateBalanceDisplay();

    // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    const responseUsers = await fetch(`https://raw.githubusercontent.com/SaweNap/dfjghdfifgJSON/main/users.json`);
    const users = await responseUsers.json();

    const userIndex = users.findIndex(u => u.id.toString() === userId);
    if (userIndex !== -1) {
      users[userIndex].balance = balance;
      await saveUsers(users);
    }
  }
};
</script>
</body>
</html>
